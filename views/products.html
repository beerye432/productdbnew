
<html>
<head>
	<title>Product Page</title>
 	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
 	<style>

 		#category{
 			width: 100%;
 		}

 		td{

 			width: 40px;
 		}

 	</style>
</head>
<body>

	<div>

		<div id = "message">

		</div>

		<div id = "name">

		</div>

		<div id = "links">
			<a href = '/'>Home</a>
			<a href = '/categories'>Categories</a>
			<a href = '/products?cat=&product='>Products</a>
			<a href = "/browseproducts?cat=&product=">Browse Products</a>
		</div>

		<h1> Add a new product: </h1>
		<form action = "/addproduct" id = "product" method = "post">
			<label for = "name">Product Name:</label>
			<input type = "text" name = "name" placeholder="Product Name">
			<label for = "sku">SKU:</label>
			<input type = "text" name = "sku" placeholder="SKU">
			<label for = "Category">Category:</label>
			<select name = "category" id = "category2">
				{{#each categories}}
					<option>{{name}}</option>
				{{/each}}
			</select>
			<label for = "Price">Price:</label>
			<input type = "text" name = "price" placeholder="Price">
			<input type = "submit" placeholder="Submit" value = "Submit">
		</form>

		<div>

			<!-- <div id="updateform" style="display:none" title="">
				
				<h2> Update Product: </h2>	￼
Strat
￼
499.99


				<form action = "/updateproduct" id = "productupdate" method = "post">

					<label for = "name"> Name: </label>
					<input id = "nameinput" type = "text" name = "name">
					<label for = "price"> Price: </label>
					<input id = "priceinput" type = "text" name = "price">
					<label for = "sku">SKU: </label>
					<input id = "sku" type = "text" name = "sku">
					<select name = "category" id = "category">
						{{#each categories}}
							<option value = "{{name}}" class = "catselect">{{name}}</option>
						{{/each}}
					</select>
					<input id = "nameO" type = "hidden" name = "nameO">
					<input type = "submit" value = "Submit">

				</form>

			</div>
 -->
			<div>

				<h1> Search for a specific product: </h1>

				<button onclick = "search('all')"> All Products </button>

				{{#each categories}}
					<button onclick = "search('{{name}}')">{{name}}</button>
				{{/each}}
			</div>


			<div>
				<form action="search" method="post">
					<label for = "search">Looking for a specific product?</label>
					<input type = "text" name = "search">
					<input id = "cat" type = "hidden" name = "category">
				    <input type="submit" value="Search">
				</form>

				<button onclick = "reset()">Reset</button>
			</div>

			<div id = "results">

			</div>

			<div>
				<table>

					<tr>
						<th>SKU</th>
						<th>Product Name</th>
						<th>Price</th>
						<th>Category</th>
					</tr>
					{{#each products}}

					<!-- <form action = "/updateproduct" id = "productupdate" method = "post">

					<label for = "name"> Name: </label>
					<input id = "nameinput" type = "text" name = "name">
					<label for = "price"> Price: </label>
					<input id = "priceinput" type = "text" name = "price">
					<label for = "sku">SKU: </label>
					<input id = "sku" type = "text" name = "sku">
					<select name = "category" id = "category">
						{{#each categories}}
							<option value = "{{name}}" class = "catselect">{{name}}</option>
						{{/each}}
					</select>
					<input id = "nameO" type = "hidden" name = "nameO">
					<input type = "submit" value = "Submit">
 -->
				</form>

						<tr>
							<form action = "updateproduct" id = "productupdate" method = "post">
								<td><input id = "sku" type = "text" name = "sku" value = "{{sku}}"></td>
								<td><input id = "nameinput" type = "text" name = "name" value = "{{name}}"></td>
								<td><input id = "priceinput" type = "text" name = "price" value = "{{price}}"></td>
								<td><select name = "category" id = "category">
								{{#each categories}}
									<option value = "{{name}}" class = "catselect">{{name}}</option>
								{{/each}}
								</select></td>
								<input type = "hidden" id = "nameO" name = "name0" value = "{{name}}">
								<td><input type = "submit" value = "Update">
								<!-- <td><a id="myLink" href="#" onclick="update('{{name}}', {{price}}, '{{sku}}', '{{category}}');">Update</a></td> -->
								<td><a href = "/deleteproduct?name={{name}}">Delete</a></td>
								<td><a href = "/productorder?name={{name}}">Add to Cart</a></td>
							</form>
						</tr>

						<!-- <div id = "{{name}}">
							<h1>{{name}}</h1>
							<h3>SKU: {{sku}}</h3>
							<h2>${{price}}</h2>
							<a id="myLink" href="#" onclick="update('{{name}}', {{price}}, '{{sku}}', '{{category}}');">Update</a>
							<a href = "/deleteproduct?name={{name}}">Delete</a>
							<a href = "/productorder?name={{name}}">Add to Cart</a>
						</div> -->

					{{/each}}
				</table>
			</div>

		</div>

	</div>

	<script src="//code.jquery.com/jquery-1.10.2.js"></script>
	<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

	<script>

		$(function() {
		    var cat = window.location.href.split("?")[1].split("&")[0].split("=")[1];

		    var product = window.location.href.split("?")[1].split("&")[1].split("=")[1];

		    if(product != ''){

		    	$("#results").append("<h3> Showing results for '"+product+"'");

		    }

			$("#cat").val(cat);

			$.get("/getname", function(response){
				$("#name").append("<h1>"+response.name+"</h1>");
				$("#name").append("<a href = '/buycart'>Buy Cart</a>");
			});

			$.get("/sesserror", function(response){

				if(response.message != ""){
					$("#message").append("<h2>"+response.message+"</h2>");
				}
			});
		});

		function search(category){

			var product = window.location.href.split("?")[1].split("&")[1].split("=")[1];

			if(category == 'all'){
				window.location.href = "/products?cat=&product="+product;
			}
			else{
				window.location.href = "/products?cat="+category+"&product="+product;
			}
		}

		function reset(){

			window.location.href = "/products?cat=&product=";
		}

		var dialog = $( "#updateform" ).dialog({
	      autoOpen: false,
	      height: 300,
	      width: 350,
	      modal: true
	    });

		function update(name, price, sku, category){

			$("#updateform").css("display", "block");

			$("#nameinput").val(name);

			$("#priceinput").val(price);

			$("#nameO").val(name);

			$("#sku").val(sku);

			dialog.dialog("open");

			$("#category option[value='"+category+"'']").attr('selected', 'selected');

			console.log(name);

			console.log(price);
		}

	</script>	
	</body>
</html>